<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.ottt.ottt.dao.CommunityMapper">

	<!-- 상세(1건) 조회 -->
	<select id="select" parameterType="int" resultType="ArticleDTO">
		/*com.ottt.ottt.dao.CommunityMapper.select 호출*/
		select 
			article_no			-- 게시물번호
			, user_no			-- 유저번호
			, article_index_no	-- 게시판구분
			, article_content	-- 게시판 내용
			, article_image		-- 사진 경로
			, article_title		-- 게시판 제목
			, to_char(article_create_dt,'YYYY-MM-DD') AS article_create_dt	-- 등록일
			, to_char(article_mod_dt,'YYYY-MM-DD') AS article_create_dt	-- 수정일
			, article_like_count	-- 좋아요 수
		from tb_article
		where article_index_no = '1' and article_no = #{article_no} 
	</select>
	
	<select id="selectAll" resultType="ArticleDTO">
		/*com.ottt.ottt.dao.CommunityMapper.selectAll 호출*/
		SELECT article_no, b.user_no, article_index_no, article_content, article_image, article_title
		, article_create_dt, article_mod_dt, article_like_count, a.report_cnt, b.user_nicknm
		FROM tb_article a, tb_user b
		where article_index_no = '1' and a.user_no = b.user_no 
		order by article_create_dt desc, article_no desc
	</select>
	
	<!-- 메인 new 목록(페이징형) -->
    <select id="getArticleList" parameterType="ArticleSearchDTO" resultType="ArticleDTO">
		
		/*com.ottt.ottt.dao.CommunityMapper.getArticleList 호출*/
		SELECT 
			article_no			-- 게시물번호
			, b.user_no			-- 유저번호
			, article_index_no	-- 게시판구분
			, article_content	-- 게시판 내용
			, article_image		-- 사진 경로
			, article_title		-- 게시판 제목
			, to_char(article_create_dt,'YYYY-MM-DD') AS article_create_dt	-- 등록일
			, to_char(article_mod_dt,'YYYY-MM-DD') AS article_create_dt	-- 수정일
			, article_like_count	-- 좋아요 수
			, a.report_cnt	
			, b.user_nicknm		-- 사용자 닉네임
		FROM tb_article a, tb_user b
		WHERE article_index_no = '1' AND a.user_no = b.user_no 
		ORDER BY article_no DESC
        LIMIT 10				-- 10개씩 보이기 고정
        OFFSET #{offset}		-- 구간 조회
    </select>
	
	<!-- 총 개수 -->
	<select id="getArticleTotalCount" parameterType="int" resultType="int">
		/*com.ottt.ottt.dao.CommunityMapper.getArticleTotalCount 호출*/
		select count(*) 
		from tb_article
		where article_index_no = '1'
	</select>
	
	<select id="selectcollection" parameterType="int" resultType="ArticleDTO">
		select article_no, b.user_no,  article_index_no, article_content, article_image, article_create_dt, article_like_count, a.report_cnt, b.user_nicknm 
		from tb_article a, tb_user b
		where article_index_no = '1' and b.user_no =#{user_no}
	</select>

	<!-- 저장 -->
	<insert id="insert" parameterType="ArticleDTO">
		/*com.ottt.ottt.dao.CommunityMapper.insert 호출*/
		INSERT INTO tb_article (
			article_content
			, article_image
			, user_no 
			,article_create_dt
			, article_index_no
		)
		VALUES(
			#{article_content}
			, ''
			,#{user_no}
			,now()
			,'1'
		)
	</insert>

	<!-- 삭제 -->
	<delete id="delete" parameterType="int">
		delete from tb_article
		where article_no = #{article_no}
	</delete>
	
	<!-- 수정 -->
	<update id="update" parameterType="ArticleDTO">
		UPDATE 
			tb_article
		SET 
			article_content = #{article_content}
			, article_image = #{article_image}
			, article_mod_dt = now()
		WHERE article_no = #{article_no} 
		AND user_no = #{user_no}
	</update>

</mapper>